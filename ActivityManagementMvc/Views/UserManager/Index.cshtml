
@{

    Layout = "_Layout";
}

<div class="container-fluid mt-2">
    <div class="row mt-5">
        <div class="card shadow w-100">
            <div class="card-header">
                مدیریت کاربران
            </div>
            <div class="card-body">
                <div id="UserGrid" class="k-rtl"></div>


            </div>
        </div>
    </div>
</div>

<div id="windowUserContainer"></div>


<script id="CreateUser" type="text/x-kendo-template">
    <a onclick=CreateUser() class='k-button k-grid-add'><i class="fa fa-plus fa-lg"></i><span class="mr-2">افزودن</span></a>

</script>


@section Scripts {
    @{

        <script type="text/javascript">
            var recordUser = 0;
            var windowUser;
            $(function () {

                //$("#panelbar").kendoPanelBar({
                //    expandMode: "single"
                //});
                UserInitialize();

            });

            function UserInitialize() {

                $("#UserGrid").html('');

                $("#UserGrid").kendoGrid({
                    toolbar: [{ template: kendo.template($("#CreateUser").html()) }, "excel"],
                    excel: { allPages: true },

                    columnMenu: true,
                    dataSource: {
                        type: "aspnetmvc-ajax",
                        transport: {
                            read: "/UserManager/GetUsers",
                            type: "POST",
                            //dataType: "json",
                            contentType: "application/json",
                            parameterMap: function (data, operation) { return JSON.stringify(data); }
                        },
                        schema: {
                            data: "Data",
                            total: "Total",
                            errors: "Errors",
                            model: {
                                id: "Id",
                                fields: {
                                    Id: { type: "number", editable: false, nullable: true },
                                    FirstName: { type: "string" },
                                    LastName: { type: "string" },
                                    UserName: { type: "string" },
                                    GenderName: { type: "string" },
                                    PersianRegisterDateTime: { type: "string" },
                                    IsActive: { type: "boolean" },
                                    RoleName: { type: "string" }

                                }

                            }
                        },
                        parameterMap: function (data, operation) {
                            return JSON.stringify(data);

                        },
                        pageSize: 10
                    },


                    serverFiltering: true,
                    serverPaging: true,
                    serverSorting: true,
                    pageable:
                    {
                        pageSizes: [10, 25, 50, 100],
                        refresh: true
                    },
                    sort:
                    {
                        field: "Id",
                        dir: "asc"
                    },
                    dataBinding: function () {
                        recordUser = (this.dataSource.page() - 1) * this.dataSource.pageSize();
                    },

                    selectable: "single row",
                    sortable: {
                        mode: "multiple"
                    },

                    editable: false,
                    filterable: true,
                    scrollable: true,
                    columns: [
                        {
                            title: "ردیف",
                            template: "#= ++recordUser #",
                            width: 50
                        },
                        { field: "FirstName", title: "نام", width: 100 },
                        { field: "LastName", title: "نام خانوادگی", width: 120 },
                        { field: "UserName", title: "نام کاربر", width: 100 },
                        { field: "RoleName", title: "نام نقش", width: 100 },
                        { field: "PersianRegisterDateTime", title: "تاریخ عضویت", width: 120 },
                        { field: "GenderName", title: "جنسیت", width: 100 },
                        {
                            field: "IsActive",
                            title: "فعال",
                            template: function (e) {
                                var fa;
                                if (e.IsActive) {
                                    fa = "<i class='fa fa-check fa-lg' style='color:#0ec515'></i>";
                                } else {
                                    fa = "<i class='fa fa-times fa-lg' style='color:#ff0000'></i>";
                                }
                                return fa;
                            }
                            //template:"<label class='switch-wrap'><input type='checkbox' #=IsActive ? checked='checked':' ' # disabled='disabled'/><div class='switch'></div></label>"


                        },
                        {
                            title: "<i class='Add' >عملیات</i>",
                            width: 80,
                            template: function (e) {

                                var str = "<a onClick='RenderMenu(this)' type='button' class='k-button'><i class='fa fa-list fa-lg'></i></a> ";
                               str +=
                                    "<ul class='burgerMenu'><li><a onClick='EditUser(" + e.Id + ")' title=' ویرایش' type='button'  class='k-button'><i class=' fa fa-edit fa-lg'></i></a><li> "+
                                        "<li><a onClick='DeleteUser(" + e.Id + ")' title='حذف' type='button'  class='k-button'><i class='fa fa-trash fa-lg'></i></a> <li>" +
                                        "<li><a onClick= 'DetailUser(" + e.Id + ")' title=' جزئیات' type='button'  class=' k-button'><i class=' fa fa-list fa-lg'></i></a><li> " +
                                        "<li><a onClick=' ResetPassword(" + e.Id + ")' title='تغییر کلمه عبور' type='button' class=' k-button'><i class='fa fa-change fa-lg'></i></a><li></ul>";
                                return str;
                            }



                        }
                    ]
                }).find("table").addClass("table table-bordered table-hover");
            }


            function RenderMenu(e) {
                $(".burgerMenu").hide();
                $(e).next().toggle();
               
            }
             
           

            function CreateUser() {

                $("#windowUser").remove();
                $("#windowUserContainer").append("<div id='windowUser'></div>");


                $.ajax({
                    type: "Get",
                    url: '/UserManager/RenderCreate/',
                    success: function (data) {
                        $("#windowUser").html(data);

                        windowUser = $("#windowUser").kendoWindow({
                            visible: true,
                            modal: true,
                            width: "800"
                        });
                        windowUser.data("kendoWindow").title('ایجاد').center().open();
                    },
                });
            }

            function EditUser(id) {
                $("#windowUser").remove();
                $("#windowUserContainer").append("<div id='windowUser'></div>");


                $.ajax({
                    type: "Get",
                    url: '/UserManager/RenderEdit/' + id,
                    success: function (data) {

                        $("#windowUser").html(data);

                        windowUser = $("#windowUser").kendoWindow({
                            visible: true,
                            modal: true,
                            width: "800"
                        });
                        windowUser.data("kendoWindow").title('ویرایش').center().open();
                    },
                });
            }

            function DeleteUser(id) {
                $("#windowUser").remove();
                $("#windowUserContainer").append("<div id='windowUser'></div>");
                $.ajax({
                    type: "Get",
                    url: '/UserManager/RenderDelete/' + id,
                    success: function (data) {
                        $("#windowUser").html(data);

                        windowUser = $("#windowUser").kendoWindow({
                            visible: true,
                            modal: true,
                            width: "800"
                        });
                        windowUser.data("kendoWindow").title('حذف').center().open();
                    }
                });
            }

            function DetailUser(id) {
                $("#windowUser").remove();
                $("#windowUserContainer").append("<div id='windowUser'></div>");
                $.ajax({
                    type: "Get",
                    url: '/UserManager/RenderDetail/' + id,
                    success: function (data) {

                        $("#windowUser").html(data);

                        windowUser = $("#windowUser").kendoWindow({
                            visible: true,
                            modal: true,
                            width: "800"
                        });
                        windowUser.data("kendoWindow").title('جزئیات').center().open();
                    }
                });
            }
            function ResetPassword(id) {
                $("#windowUser").remove();
                $("#windowUserContainer").append("<div id='windowUser'></div>");
                $.ajax({
                    type: "Get",
                    url: '/UserManager/ResetPassword/',
                    data: { userId: id },
                    success: function (data) {

                        $("#windowUser").html(data);

                        windowUser = $("#windowUser").kendoWindow({
                            visible: true,
                            modal: true,
                            width: "800"
                        });
                        windowUser.data("kendoWindow").title('تغییر کلمه عبور').center().open();
                    }
                });
            }

            function UserGridRefresh() {
                var grid = $("#UserGrid").data("kendoGrid");
                grid.dataSource.read();
                try { windowUser.data('kendoWindow').close(); } catch (e) { }
            }
        </script>
    }
}



